[TOC]

> * 本部分为旋转、从表格抠格子、判断是否毕业和最终纠错。
> * `code/`文件夹为代码，`data/`文件夹为数据。

# 编译环境
操作系统`Ubuntu 16.04`，Python版本`python 3.6.5`，部分源代码需要`jupyter-notebook`。

# 按功能部分讲解

### 图像旋转
> `rotate.py`
* 读入图像，转为灰度图，再做高斯滤波、Canny变换、霍夫变换，从而得到图中所有直线的长度和角度
* 对角度值处理，得到倾斜角度`rotate_angle`
* 根据倾斜度对图像旋转，使之摆正
* 对旋转后的黑边填充白色
* 保存

### 抠出格子
> `cut.py`
* 读入图像，转为灰度图，转为二值图
* 分别对横向和纵向做**腐蚀**和**膨胀**，得到横线和竖线
* 对横竖线交叉，得到交点坐标
* 选取最左上角交点作为基准参考点
* **画白线**。表格边缘黑线影响后期识别，故根据腐蚀膨胀得到的直线对表格边缘用白线覆盖
* 对文件分类（通过文件名、检测特定区域像素值）
* 根据类别`type`读入预制的格子偏移量模板
* **校正**。直接套模板裁剪是不准的，用模板偏移量和第三步得到的交点坐标进行匹配，从而确定精准的裁剪坐标
* **裁剪**。因为很多人喜欢沿着表格下方的线写，字就会超出表格，故多向下取8像素
* 根据格子所属项目分类保存
    
### 判断是否毕业
> `pass_or_not.ipynb`
* 从`cut_image`文件夹读取*是否毕业*字段图像
* 转为灰度图，转为二值图
* 腐蚀膨胀，横纵线交叉，检测出小方框的左上角坐标作为参照点
* 分别对格子中、格子上、格子下区域统计像素值
* **判断**。因为对勾的笔记会存在于这三个区域，通过对像素值的判断确定是或否
* 结果保存为`pass_or_not.csv`文件，供后续使用

### 最终纠错
> `纠错高中大专本科研究生 校名+专业.ipynb`
* 读入机器学习识别出的结果`A`
* 读入预先爬虫得到的全国院校（专业）名单`B`
* 若`A`为'无',则不做修改
* 若不是'无'，则将`A`与`B`中所有条目依次计算**最小编辑距离**，若最小值者唯一则直接进行纠正
* 若最小值者不唯一，继续在剩下的结果中计算**相同字数**或**余弦相似度**
* 若相似度最高者唯一则纠正，若不唯一则选取结果中第一个出现的做填充
* 保存纠正后的csv文件